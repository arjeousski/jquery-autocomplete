(function(n){"use strict";n.fn.autocomplete=function(t){var i,r;return arguments.length>1?(i=t,t=arguments[1],t.url=i):typeof t=="string"&&(i=t,t={url:i}),r=n.extend(!0,{},n.fn.autocomplete.defaults,t),this.each(function(){var t=n(this);t.data("autocompleter",new n.Autocompleter(t,n.meta?n.extend({},r,t.data()):r))})},n.fn.autocomplete.defaults={inputClass:"acInput",inputAcClass:"acInput-back",inputWrapper:"acWrapper",loadingClass:"acLoading",resultsClass:"acResults",selectClass:"acSelect",queryParamName:"q",extraParams:{},remoteDataType:!1,lineSeparator:"\n",cellSeparator:"|",minChars:2,maxItemsToShow:10,delay:400,useCache:!0,maxCacheLength:10,matchSubset:!0,matchCase:!1,matchInside:!0,mustMatch:!1,selectFirst:!1,selectOnly:!1,showResult:null,preventDefaultReturn:1,preventDefaultTab:0,autoFill:!1,filterResults:!0,filter:!0,sortResults:!0,sortFunction:null,onItemSelect:null,onNoMatch:null,onFinish:null,matchStringConverter:null,beforeUseConverter:null,autoWidth:"min-width",useDelimiter:!1,delimiterChar:",",delimiterKeyCode:188,processData:null,onError:null,limitParam:null,skipParam:null,numLoadInitial:10,numLoadSubsequent:100};var i=function(t){var i,r,u=typeof t;return u==="string"?(i=t,r={}):n.isArray(t)?(i=t[0],r=t.slice(1)):u==="object"&&(i=t.value,r=t.data),i=String(i),typeof r!="object"&&(r={}),{value:i,data:r}},t=function(n,t,i){var r=parseInt(n,10);return i=i||{},(isNaN(r)||i.min&&r<i.min)&&(r=t),r},r=function(n,t){return[n,encodeURIComponent(t)].join("=")},u=function(t,i){var u=[];return n.each(i,function(n,t){u.push(r(n,t))}),u.length&&(t+=t.indexOf("?")===-1?"?":"&",t+=u.join("&")),t},f=function(n,t,i){return(n=String(n.value),t=String(t.value),i||(n=n.toLowerCase(),t=t.toLowerCase()),n>t)?1:n<t?-1:0},e=function(n,t,i){var h=[],r,u,f,e,c,o,s;if(s=String(n).replace("\r\n","\n"),s.length>0)for(o=s.split(t),r=0;r<o.length;r++){for(e=o[r].split(i),f=[],u=0;u<e.length;u++)f.push(decodeURIComponent(e[u]));c=f.shift(),h.push({value:c,data:f})}return h};n.Autocompleter=function(i,r){var u,f,e,o;if(!i||!(i instanceof n)||i.length!==1||i.get(0).tagName.toUpperCase()!=="INPUT")throw new Error("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT tag expected.");u=this,this.options=r,this.cacheData_={},this.cacheLength_=0,this.selectClass_="jquery-autocomplete-selected-item",this.keyTimeout_=null,this.blurTimeout_=null,this.focusTimeout_=null,this.lastKeyPressed_=null,this.lastProcessedValue_=null,this.lastSelectedValue_=null,this.showingResults_=!1,this.finishOnBlur_=!0,this.fetchRemoteRequest_=null,this.numFetched_=null,this.isMouseOverControlElement_=null,this.options.minChars=t(this.options.minChars,n.fn.autocomplete.defaults.minChars,{min:0}),this.options.maxItemsToShow=t(this.options.maxItemsToShow,n.fn.autocomplete.defaults.maxItemsToShow,{min:0}),this.options.maxCacheLength=t(this.options.maxCacheLength,n.fn.autocomplete.defaults.maxCacheLength,{min:1}),this.options.delay=t(this.options.delay,n.fn.autocomplete.defaults.delay,{min:0}),this.options.preventDefaultReturn!==2&&(this.options.preventDefaultReturn=this.options.preventDefaultReturn?1:0),this.options.preventDefaultTab!==2&&(this.options.preventDefaultTab=this.options.preventDefaultTab?1:0),this.dom={},this.dom.$elem=i,this.dom.$elem.attr("autocomplete","off").addClass(this.options.inputClass),this.dom.$acelem=this.dom.$elem.clone().attr({id:"",disabled:"disabled"}).addClass(this.options.inputAcClass),this.dom.$elem.wrap(n('<div><div class="inputWrap"><\/div><\/div>').addClass(this.options.inputWrapper)),this.dom.$box=this.dom.$elem.parent().parent(),this.dom.$arrow=n('<div class="arrow"><\/div>'),this.dom.$box.append(this.dom.$arrow),this.dom.$elem.parent().append(this.dom.$acelem),this.dom.$text=n("<div><\/div>",{"class":"disabledText"}).hide(),this.dom.$elem.parent().append(this.dom.$text),this.dom.$results=n("<div><\/div>").hide().addClass(this.options.resultsClass).css({position:"absolute"}),n("body").append(this.dom.$results),this.dom.$list=n("<ul><\/ul>"),this.dom.$results.append(this.dom.$list),i.keydown(function(n){u.lastKeyPressed_=n.keyCode;switch(u.lastKeyPressed_){case u.options.delimiterKeyCode:u.options.useDelimiter&&u.showingResults_&&u.selectCurrent();break;case 35:case 36:case 16:case 17:case 18:case 37:case 39:break;case 33:return n.preventDefault(),u.showingResults_?u.focusPageUp():u.activate(),!1;case 34:return n.preventDefault(),u.showingResults_?u.focusPageDown():u.activate(),!1;case 38:return n.preventDefault(),u.showingResults_?u.focusPrev():u.activate(),!1;case 40:return n.preventDefault(),u.showingResults_?u.focusNext():u.activate(),!1;case 9:if(u.showingResults_&&(u.selectCurrent(),u.options.preventDefaultTab)||u.options.preventDefaultTab===2)return n.preventDefault(),!1;break;case 13:if(u.showingResults_&&(u.selectCurrent(),u.options.preventDefaultReturn)||u.options.preventDefaultReturn===2)return n.preventDefault(),!1;break;case 27:if(u.showingResults_)return n.preventDefault(),u.deactivate(!0),!1;break;default:u.activate()}return!0}),f=function(){u.isMouseOverControlElement_&&u.showingResults_?setTimeout(function(){u.dom.$elem.focus()},0):u.deactivate(!0,!0)};i.on("blur",function(){u.finishOnBlur_&&(u.blurTimeout_=setTimeout(f,200))});e=function(){if(u.lastSelectedValue_==null){var n=u.getValue();u.lastSelectedValue_=n,u.setAcValue(u.lastSelectedValue_),u.setValue(""),u.activate()}};i.on("focus",function(){u.focusTimeout_=setTimeout(e,200)});o=function(){var t=n(this);t[0].scrollHeight>t.innerHeight()&&t.scrollTop()+t.innerHeight()>=t[0].scrollHeight&&u.numFetched_!==-1&&(u.fetchMoreTimeout_&&clearTimeout(u.fetchMoreTimeout_),u.fetchMoreTimeout_=setTimeout(function(){u.fetchData(u.lastProcessedValue_,!0)},100))};this.dom.$list.on("scroll",o);u.preventBlur(this.dom.$results),this.dom.$elem.click(function(n){n.stopPropagation()}),this.dom.$arrow.click(function(n){return u.showingResults_||u.dom.$elem.focus(),n.preventDefault(),!1});i.parents("form").on("submit",f);this.enable()},n.Autocompleter.prototype.preventBlur=function(n){var t=this;n.on("mouseenter",function(){t.isMouseOverControlElement_=!0});n.on("mouseleave",function(){t.isMouseOverControlElement_=!1})},n.Autocompleter.prototype.setFloat=function(t){var i=this;this.dom.$extra=n("<div><\/div>",{"class":this.options.resultsClass+" acResultsFloat"}).hide().css({position:"absolute",top:0}),i.preventBlur(this.dom.$extra),this.dom.$extra.append(t),n("body").append(this.dom.$extra)},n.Autocompleter.prototype.position=function(){var o,r,e,a,h,i;this.itemHeight_&&(r=this.getItems(),o=r.length<this.options.maxItemsToShow?r.length:this.options.maxItemsToShow,this.dom.$list.height(this.itemHeight_*o));var t=this.dom.$box.offset(),u=this.dom.$results.outerHeight(),c=n(window).outerHeight(),f=t.top+this.dom.$box.outerHeight(),l=f+u,s={top:f,left:t.left};l>c&&(e=t.top-u,e>=0&&(s.top=e)),this.dom.$results.css(s),this.dom.$extra&&(a=this.dom.$extra.outerHeight(),h={top:f+u,left:t.left},this.dom.$extra.css(h)),this.options.autoWidth&&(i=this.dom.$box.outerWidth()-this.dom.$results.outerWidth()+this.dom.$results.width(),n(">ul",this.dom.$results).css(this.options.autoWidth,i),this.dom.$extra&&(i=this.dom.$box.outerWidth()-this.dom.$extra.outerWidth()+this.dom.$extra.width(),this.dom.$extra.css(this.options.autoWidth,i)))},n.Autocompleter.prototype.cacheRead=function(n){var i,t,r,f,u;if(this.options.useCache)for(n=String(n),i=n.length,t=this.options.matchSubset?1:i;t<=i;){for(f=this.options.matchInside?i-t:0,u=0;u<=f;){if(r=n.substr(0,t),this.cacheData_[r]!==undefined)return this.cacheData_[r];u++}t++}return!1},n.Autocompleter.prototype.cacheWrite=function(n,t){return this.options.useCache?(this.cacheLength_>=this.options.maxCacheLength&&this.cacheFlush(),n=String(n),this.cacheData_[n]!==undefined&&this.cacheLength_++,this.cacheData_[n]=t,this.cacheData_[n]):!1},n.Autocompleter.prototype.cacheFlush=function(){this.cacheData_={},this.cacheLength_=0},n.Autocompleter.prototype.disable=function(){this.deactivate(!0),this.dom.$box.addClass("acDisabled"),this.dom.$arrow.hide(),this.dom.$acelem.hide(),this.dom.$elem.hide();var n=this.getValue();this.dom.$text.html(n),this.dom.$text.show(),this.dom.$box.off("click")},n.Autocompleter.prototype.enable=function(){var n=this;this.dom.$text.hide(),this.dom.$arrow.show(),this.dom.$acelem.show(),this.dom.$elem.show(),this.dom.$box.removeClass("acDisabled");this.dom.$box.on("click",function(){n.dom.$elem.focus()})},n.Autocompleter.prototype.cleanDOM=function(){this.dom.$box.remove(),this.dom.$results.remove(),this.dom.$extra.remove()},n.Autocompleter.prototype.callHook=function(t,i){var r=this.options[t];return r&&n.isFunction(r)?r(i,this):!1},n.Autocompleter.prototype.activate=function(){var n=this;this.keyTimeout_&&clearTimeout(this.keyTimeout_),this.keyTimeout_=setTimeout(function(){n.activateNow()},this.options.delay)},n.Autocompleter.prototype.activateNow=function(){var n=this.beforeUseConverter(this.dom.$elem.val());(n!==this.lastProcessedValue_||this.lastKeyPressed_===46||this.lastKeyPressed_===8)&&this.fetchData(n)},n.Autocompleter.prototype.fetchData=function(n,t){var i=this,r;t||(i.numFetched_=0),r=function(n,t,r){i.options.processData&&(n=i.options.processData(n)),!r&&n.length===i.options.numLoadInitial||r&&n.length===i.options.numLoadSubsequent?i.numFetched_+=n.length:i.numFetched_=-1,i.showResults(i.filterResults(n,t),t,r)},t||(this.lastProcessedValue_=n),n.length<this.options.minChars?r([],n):this.options.data?r(this.options.data,n):this.fetchRemoteData(n,t,function(t,i){r(t,n,i)})},n.Autocompleter.prototype.fetchRemoteData=function(t,i,r){var f=this.cacheRead(t);if(f)r(f);else{var u=this,o=u.options.remoteDataType==="json"?"json":"text",e=function(n){var f=!1;n!==!1&&(f=u.parseRemoteData(n),u.cacheWrite(t,f)),u.dom.$elem.removeClass(u.options.loadingClass),r(f,i)};this.dom.$elem.addClass(this.options.loadingClass),this.fetchRemoteRequest_&&(this.fetchRemoteRequest_.abort(),this.fetchRemoteRequest_=null),this.fetchRemoteRequest_=n.ajax({url:this.makeUrl(t,i),success:e,error:function(t,i,r){if(n.isFunction(u.options.onError))u.options.onError(t,i,r);else e(!1)},complete:function(){u.fetchRemoteRequest_=null},dataType:o})}},n.Autocompleter.prototype.setExtraParam=function(t,i){var r=n.trim(String(t));r&&(this.options.extraParams||(this.options.extraParams={}),this.options.extraParams[r]!==i&&(this.options.extraParams[r]=i,this.cacheFlush(),this.showingResults_&&(this.lastProcessedValue_=null,this.activateNow())))},n.Autocompleter.prototype.makeUrl=function(t,i){var o=this,e=this.options.url,r={},f;return this.options.limitParam&&(i?(r[this.options.limitParam]=this.options.numLoadSubsequent,r[this.options.skipParam]=this.numFetched_):(r[this.options.limitParam]=this.options.numLoadInitial,r[this.options.skipParam]=0)),f=n.extend({},this.options.extraParams,r),this.options.queryParamName===!1?e+=encodeURIComponent(t):f[this.options.queryParamName]=t,u(e,f)},n.Autocompleter.prototype.parseRemoteData=function(t){var r,i=t;if(this.options.remoteDataType==="json"){r=typeof t;switch(r){case"object":i=t;break;case"string":i=n.parseJSON(t);break;default:throw new Error("Unexpected remote data type: "+r);}return i}return e(i,this.options.lineSeparator,this.options.cellSeparator)},n.Autocompleter.prototype.defaultFilter=function(n,t){var i,r,u;return n.value?this.options.filterResults?(i=this.matchStringConverter(t),r=this.matchStringConverter(n.value),this.options.matchCase||(i=i.toLowerCase(),r=r.toLowerCase()),u=r.indexOf(i),this.options.matchInside?u>-1:u===0):!0:!1},n.Autocompleter.prototype.filterResult=function(t,i){return this.options.filter===!1?!0:n.isFunction(this.options.filter)?this.options.filter(t,i):this.defaultFilter(t,i)},n.Autocompleter.prototype.filterResults=function(n,t){for(var r=[],f,u=0;u<n.length;u++)f=i(n[u]),this.filterResult(f,t)&&r.push(f);return this.options.sortResults&&(r=this.sortResults(r,t)),r},n.Autocompleter.prototype.sortResults=function(t,i){var u=this,r=this.options.sortFunction;return n.isFunction(r)||(r=function(n,t){return f(n,t,u.options.matchCase)}),t.sort(function(n,t){return r(n,t,i,u.options)}),t},n.Autocompleter.prototype.matchStringConverter=function(t,i,r){var u=this.options.matchStringConverter;return n.isFunction(u)&&(t=u(t,i,r)),t},n.Autocompleter.prototype.beforeUseConverter=function(t,i,r){t=this.getValue();var u=this.options.beforeUseConverter;return n.isFunction(u)&&(t=u(t,i,r)),t},n.Autocompleter.prototype.enableFinishOnBlur=function(){this.finishOnBlur_=!0},n.Autocompleter.prototype.disableFinishOnBlur=function(){this.finishOnBlur_=!1},n.Autocompleter.prototype.createItemFromResult=function(t){var i=this,r=n("<li>"+this.showResult(t.value,t.data)+"<\/li>");return r.data({value:t.value,data:t.data}).click(function(){i.selectItem(r)}).mousedown(i.disableFinishOnBlur).mouseup(i.enableFinishOnBlur),r},n.Autocompleter.prototype.getItems=function(){return this.$itemsCache_||(this.$itemsCache_=n(">ul>li",this.dom.$results)),this.$itemsCache_},n.Autocompleter.prototype.showResults=function(n,t,i){var f=n.length,e=this,r,h,u,o,s,c;if(this.$itemsCache_=null,i||this.dom.$list.empty(),o=!1,s=!1,f){for(r=0;r<f;r++)h=n[r],u=this.createItemFromResult(h),this.dom.$list.append(u),i||(o===!1&&(o=String(h.value),s=u,u.addClass(this.options.firstItemClass)),r===f-1&&u.addClass(this.options.lastItemClass));this.dom.$results.show(),this.dom.$extra&&this.dom.$extra.show(),i||setTimeout(function(){e.dom.$list.scrollTop(0)},0),e.itemHeight_||(e.itemHeight_=s.outerHeight()),this.position(),c=this.getItems(),i&&c.unbind("mouseenter mouseleave"),this.getItems().hover(function(){e.focusItem(this)},function(){}),i||((this.autoFill(o,t)||this.options.selectFirst||this.options.selectOnly&&f===1)&&this.focusItem(s),this.showingResults_=!0)}else this.hideResults(),this.showingResults_=!1,this.setAcValue("")},n.Autocompleter.prototype.showResult=function(t,i){return n.isFunction(this.options.showResult)?this.options.showResult(t,i):t},n.Autocompleter.prototype.autoFill=function(n,t){var r,u,i;if(this.options.autoFill){if(r=String(n).toLowerCase(),u=String(t).toLowerCase(),i=t.length,i>0&&r.substr(0,i)===u)return this.lastProcessedValue_=n.substr(0,i),this.setValue(this.lastProcessedValue_),this.setAcValue(n),!0;i==0?this.setAcValue(this.lastSelectedValue_):this.setAcValue("")}return!1},n.Autocompleter.prototype.focusPageDown=function(){this.focusMove(+this.options.maxItemsToShow)},n.Autocompleter.prototype.focusPageUp=function(){this.focusMove(-this.options.maxItemsToShow)},n.Autocompleter.prototype.focusNext=function(){this.focusMove(1)},n.Autocompleter.prototype.focusPrev=function(){this.focusMove(-1)},n.Autocompleter.prototype.focusMove=function(i){var u=this.getItems(),r;if(i=t(i,0),i)for(r=0;r<u.length;r++)if(n(u[r]).hasClass(this.selectClass_)){this.focusItem(r+i);return}this.focusItem(0)},n.Autocompleter.prototype.focusItem=function(t){var i,r=this.getItems(),u=r.filter("."+this.selectClass_);r.length&&(u.removeClass(this.selectClass_).removeClass(this.options.selectClass),typeof t=="number"?(t<0?t=0:t>=r.length&&(t=r.length-1),i=n(r[t])):i=n(t),i&&(i.addClass(this.selectClass_).addClass(this.options.selectClass),this.scrollItemIntoView(i)))},n.Autocompleter.prototype.scrollItemIntoView=function(n){var u=n.outerHeight(),i=this.dom.$list,f=i.innerHeight(),e=i.scrollTop(),t=(n.position()||{}).top,r=null,o=parseInt(i.css("paddingTop"));t!=null&&(t+u>f&&(r=t+u+e-f+o),t<0&&(r=t+e-o),r!=null&&i.scrollTop(r))},n.Autocompleter.prototype.selectCurrent=function(t){var i=n("li."+this.selectClass_,this.dom.$results);i.length===1?this.selectItem(i,t):this.deactivate(!0)},n.Autocompleter.prototype.selectItem=function(n){var u=n.data("value"),f=n.data("data"),t=this.displayValue(u,f),e=this.beforeUseConverter(t);this.lastProcessedValue_=e,this.lastSelectedValue_=e;var i=this.getDelimiterOffsets(),r=this.options.delimiterChar,o=this.dom.$elem,s=0;this.options.useDelimiter&&(o.val().substring(i.start-1,i.start)===r&&r!==" "&&(t=" "+t),o.val().substring(i.end,i.end+1)!==r&&this.lastKeyPressed_!==this.options.delimiterKeyCode?t=t+r:s=1),this.setValue(t),this.setAcValue(""),this.callHook("onItemSelect",{value:u,data:f}),this.deactivate(!0)},n.Autocompleter.prototype.displayValue=function(t,i){return n.isFunction(this.options.displayValue)?this.options.displayValue(t,i):t},n.Autocompleter.prototype.hideResults=function(){this.dom.$results.hide(),this.dom.$extra&&this.dom.$extra.hide()},n.Autocompleter.prototype.deactivate=function(n,t){this.blurTimeout_&&clearTimeout(this.blurTimeout_),this.keyTimeout_&&clearTimeout(this.keyTimeout_),this.focusTimeout_&&clearTimeout(this.focusTimeout_),n&&(this.lastProcessedValue_!==this.lastSelectedValue_&&(this.options.mustMatch&&(this.lastSelectedValue_!=null&&this.lastSelectedValue_.length>0?this.setValue(this.lastSelectedValue_):this.setValue("")),this.callHook("onNoMatch")),this.showingResults_&&this.callHook("onFinish"),this.lastKeyPressed_=null,this.lastProcessedValue_=null,this.lastSelectedValue_=null,this.showingResults_=!1),this.setAcValue(""),this.hideResults(),t||this.dom.$elem.blur()},n.Autocompleter.prototype.selectRange=function(n,t){var i=this.dom.$elem.get(0),r;i.setSelectionRange?(i.focus(),i.setSelectionRange(n,t)):i.createTextRange&&(r=i.createTextRange(),r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",n),r.select())},n.Autocompleter.prototype.setCaret=function(n){this.selectRange(n,n)},n.Autocompleter.prototype.getCaret=function(){var i=this.dom.$elem,r,f,e,t,u,o;return n.support.cssFloat?(r=i[0].selectionStart,f=i[0].selectionEnd):(e=document.selection,i[0].tagName.toLowerCase()!=="textarea"?(u=i.val(),t=e.createRange().duplicate(),t.moveEnd("character",u.length),r=t.text===""?u.length:u.lastIndexOf(t.text),t=e.createRange().duplicate(),t.moveStart("character",-u.length),f=t.text.length):(t=e.createRange(),o=t.duplicate(),o.moveToElementText(i[0]),o.setEndPoint("EndToEnd",t),r=o.text.length-t.text.length,f=r+t.text.length)),{start:r,end:f}},n.Autocompleter.prototype.setValue=function(n){if(this.options.useDelimiter){var t=this.dom.$elem.val(),i=this.getDelimiterOffsets(),r=t.substring(0,i.start),u=t.substring(i.end);n=r+n+u}this.dom.$elem.val(n)},n.Autocompleter.prototype.setAcValue=function(n){if(this.options.useDelimiter){var t=this.dom.$elem.val(),i=this.getDelimiterOffsets(),r=t.substring(0,i.start),u=t.substring(i.end);n=r+n+u}this.dom.$acelem.val(n)},n.Autocompleter.prototype.getValue=function(){var t=this.dom.$elem.val(),n;return this.options.useDelimiter?(n=this.getDelimiterOffsets(),t.substring(n.start,n.end).trim()):t},n.Autocompleter.prototype.getDelimiterOffsets=function(){var t=this.dom.$elem.val(),i,n,r,u;return this.options.useDelimiter?(r=t.substring(0,this.getCaret().start),i=r.lastIndexOf(this.options.delimiterChar)+1,u=t.substring(this.getCaret().start),n=u.indexOf(this.options.delimiterChar),n===-1&&(n=t.length),n+=this.getCaret().start):(i=0,n=t.length),{start:i,end:n}}})(jQuery);